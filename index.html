<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>To-Do Dashboard</title>

  <script type="module">
    window.addEventListener('DOMContentLoaded', () => {
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-app.js";
      import { 
        getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged 
      } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-auth.js";
      import { 
        getFirestore, collection, addDoc, getDocs, query, where, deleteDoc, doc 
      } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-firestore.js";

      import { firebaseConfig } from "./config.js";

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      const allowedEmails = ["your.email@example.com"]; // replace with your authorized emails

      let currentUser = null;

      // DOM elements
      const loginBtn = document.getElementById("loginBtn");
      const logoutBtn = document.getElementById("logoutBtn");
      const taskForm = document.getElementById("taskForm");
      const taskInput = document.getElementById("taskInput");
      const statusSelect = document.getElementById("statusSelect");
      const accessDeniedMsg = document.getElementById("accessDenied");
      const userDisplay = document.getElementById("userDisplay");

      loginBtn.onclick = async () => {
        const provider = new GoogleAuthProvider();
        try { await signInWithPopup(auth, provider); } 
        catch (error) { console.error("Sign-in error:", error); alert("Google Sign-In failed."); }
      };

      logoutBtn.onclick = async () => { await signOut(auth); };

      onAuthStateChanged(auth, (user) => {
        if (user) {
          const normalizedAllowed = allowedEmails.map(e => e.toLowerCase().trim());
          const normalizedUser = user.email.toLowerCase().trim();

          console.log("Signed in as:", user.email);
          console.log("Allowed emails:", normalizedAllowed);
